___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Elle",
  "categories": ["CHAT", "CONVERSIONS"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "This app will add Elle\u0027s Intelligent Text Messaging to your site by configuring HTML IDs/classes where Elle should be triggered.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "config",
    "displayName": "Elle Configuration",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "elleOrgId",
        "displayName": "Elle Organization ID",
        "simpleValueType": true
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

var log = require('logToConsole');
var injectScript = require('injectScript');
var queryPermission = require('queryPermission');
var createQueue = require('createQueue');
var getQueryParameters = require('getQueryParameters');
var getUrl = require('getUrl');
var createArgumentsQueue = require('createArgumentsQueue');

const pageHost = getUrl('host');
const pagePath = getUrl('path');
const elleOrgId = data.elleOrgId;
const elleEnv = getQueryParameters('elleEnv');
const elle_evid = getQueryParameters('evid');
var vendor_name;
var vendor_site_id;
var elle_script_url = '';
var segment_scrit_url = "";

if(elleEnv === "sandbox"){
  segment_scrit_url = "//cdn.segment.com/analytics.js/v1/hSVqY8ADUn4ylWtoQUoF91pUTpo3eXen/analytics.min.js";
  elle_script_url = "//d4hldqmvpzsy0.cloudfront.net/assets/elle_button_debug.js";
} else {
  segment_scrit_url = "//cdn.segment.com/analytics.js/v1/8nUz0UY5YHbfgiL90Gjykt0NusCPCnY9/analytics.min.js";
  elle_script_url = "//d4hldqmvpzsy0.cloudfront.net/assets/elle_button.js";
}

const currentVendor = () => {
  var SHAREONE = 'shareone';
  var MORTGAGEBOT = 'mortgagebot';
  var ACCESS_SOFTEK = 'access_softek';
  var CU_DIRECT = 'cu_direct';
  
  var domains_reference = {
    'ns3web\\.com$': {
      vendor_name: SHAREONE,
      vendor_site_id: pageHost
    },
    'mortgagewebcenter\\.com$': {
      vendor_name: MORTGAGEBOT,
      vendor_site_id: pageHost
    },
    'mfmnow\\.com$': {
      vendor_name: ACCESS_SOFTEK,
      vendor_site_id: ''
    },
    'mobilelending\\-.*(.|-)financialhost\\.org$': {
      vendor_name: ACCESS_SOFTEK,
      vendor_site_id: pageHost
    },
    'mobilelending\\-.*\\.orpheusdev\\.net$': {
      vendor_name: ACCESS_SOFTEK,
      vendor_site_id: pageHost
    },
    '\\.cudlautosmart\\.com$': {
      vendor_name: CU_DIRECT,
      vendor_site_id: pageHost
    }
  };
  
  var paths_reference = {
    '^\\/NSLoan': {
      vendor_name: SHAREONE,
        vendor_site_id: pageHost
    }
  };

  var current_vendor;
  
  for (var host_matcher in domains_reference) {
    if ( pageHost.match(host_matcher) ) {
      current_vendor = domains_reference[host_matcher];
      break; 
    }
  }

  if (typeof(current_vendor) == 'undefined') {
    for (var path_matcher in paths_reference) {
      if ( pagePath.match(path_matcher) ) {
        current_vendor = paths_reference[path_matcher];
        break; 
      }
    }
  }
  
  return current_vendor;

};

const extractVendorField = (vendorAttributeName, vendorReference) => {
  if (!vendorReference) { return; }
  var vendor_attribute_value;
  var attr_val = vendorReference[vendorAttributeName];
  
  if (typeof(attr_val) === 'function') {
    vendor_attribute_value = attr_val();
  } else {
    vendor_attribute_value = attr_val;
  }
  
  if (vendor_attribute_value){
    vendor_attribute_value = vendor_attribute_value.toLowerCase();
  }
  
  return vendor_attribute_value;
};

var vendor_reference = currentVendor();
var vendor_name = extractVendorField('vendor_name', vendor_reference);
var vendor_site_id = extractVendorField('vendor_site_id', vendor_reference);

var elle_config = {
  platform_type: "Google Tag Manager",
  org_id: elleOrgId,
  evid: elle_evid,
  vendor_name: vendor_name,
  vendor_site_id: vendor_site_id
};

if (elleEnv === "sandbox") {
  log('container: Elle Tag');
  log("container: pageHost: ", pageHost);
  log("container: pagePath: ", pagePath);
  log('container: data =', data);
  log("container: org_id: ", elleOrgId);
  log("container: vendor_name: ", vendor_name);
  log("container: vendor_site_id: ", vendor_site_id);
  log("container: elle_evid: ", elle_evid);
  log("container: elle_script_url: ", elle_script_url);
}

const dataLayerPush = createQueue('_elleDataLayer');
dataLayerPush(elle_config);

let numCallbacks = 2;
let hasFailed = false;

const processAsync = (succeeded) => {
  if (hasFailed) return;
  
  log('processAsync', succeeded);
  if (succeeded) {
    numCallbacks--;
    if (numCallbacks === 0) {
      data.gtmOnSuccess();
    }
  } else {
    hasFailed = true;
    data.gtmOnFailure();
  }
};

if (queryPermission('inject_script', elle_script_url)){
  injectScript(elle_script_url, processAsync(true), processAsync(false));
}

if (queryPermission('inject_script', segment_scrit_url)){
  injectScript(segment_scrit_url, processAsync(true), processAsync(false));
}

const elle = createArgumentsQueue('elle_analytics_queue', 'elle_analytics_queue.methods');
if (!!elle_evid) { 
  elle('identify', elle_evid); 
}
if (!!vendor_name && !!vendor_site_id) { 
  elle('page', { vendor_name: vendor_name, vendor_site_id: vendor_site_id });
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://d4hldqmvpzsy0.cloudfront.net/assets/elle_button.js"
              },
              {
                "type": 1,
                "string": "https://d4hldqmvpzsy0.cloudfront.net/assets/elle_button_debug.js"
              },
              {
                "type": 1,
                "string": "https://cdn.segment.com/analytics.js/v1/hSVqY8ADUn4ylWtoQUoF91pUTpo3eXen/analytics.min.js"
              },
              {
                "type": 1,
                "string": "https://cdn.segment.com/analytics.js/v1/8nUz0UY5YHbfgiL90Gjykt0NusCPCnY9/analytics.min.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_elleDataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "elle_analytics_queue"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "elle_analytics_queue.methods"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: success production
  code: |
    const mockData = {
      elleOrgId: 1
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully (after the elle script was injected).
    assertApi('gtmOnSuccess').wasCalled();


    // https://developers.google.com/tag-manager/templates/api
    // https://developers.google.com/tag-manager/templates/tests
    // https://www.thyngster.com/test-api-unit-testing-for-google-tag-manager-custom-templates/
- name: missing elleOrgId
  code: |
    const mockData = {
      elleEnv: 'sandbox'
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully (after the elle script was injected).
    assertApi('gtmOnSuccess').wasCalled();
setup: "var log = require('logToConsole');\n\nmock('getUrl', (component) => {\n  if\
  \ (component == \"host\") {\n  \treturn 'www.example.com';\n  } \n  else if (component\
  \ == \"path\") {\n    return 'path';\n  } \n  else {\n  \tfail(\"wrong url component\"\
  );\n  }\n});\n\nmock('getQueryParameters', (queryKey, retrieveAll) => {\n  if (queryKey\
  \ == \"evid\") {\n  \treturn 'evid_00c0f000-00ea-f000-0bb0-c000000e0000';\n  } \n\
  \  else {\n  \treturn null;\n  }\n});"


___NOTES___

Created on 1/29/2020, 10:40:20 PM


